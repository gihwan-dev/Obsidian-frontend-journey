## 회고
오늘은 SK 하이닉스 대시보드 작업을 회고 하며 부검을 진행했습니다ㅎㅎ 이번주 SK 하이닉스의 API 변경과, 기획 변경에 대응했는데 이 작업이 제 상상보다 너무 오래 걸리고 어려웠어서 이건 한 번 해야겠다... 라는 생각을 했던거 같아요!

## 아쉬웠던 점
#### 1. 너무 큰 역할을 했던 Provider
기존에는 Fab, Cluster, System, Instance로 GroupBy 하는 형태의 필터 였습니다. 각 그룹별 엔드포인트가 각각 있었는데, 이걸 하나의 Provider에서 모두 Suspense Query로 `fetch` 하고 합쳐서 전달하는 구조로 만들었습니다.

이번 요구사항에서 GroupBy가 제거되었고, Site - Fab - Instnace의 필터와 Fab - Instance 필터만 남기게 되었습니다. Site, Fab 두 가지 그룹바이 리스트를 제공하는 엔드포인트가 제공되었고 이를 적용하려 했습니다.

다만 문제는, 기존에는 하나의 거대한 Provider를 두 페이지에서 재사용 했지만 새로운 구조에서는 그럴 수 없다는 점이었습니다. 기존에는 그래도 약간이라도 Fab 그룹 이라는 공통 분모가 있었는데, 이제는 완전히 없어졌습니다.

Provider의 책임이 많다 보니 이에 의존하는 모듈들도 정말 많았고, 역할이 크다 보니 변경점도 많았습니다. 해당 부분은 SiteGroupProvider, FabGroupProvider 라는 두 가지 Provider로 분리하고, 책임을 축소한 뒤 각 페이지에서 필요한 Provider를 사용하는 방식으로 수정했습니다.

당시 느꼈던 점은 Provider의 책임은 작을 수록 적고, 영향 범위 또한 작을 수록 좋다는것 이었습니다.

#### 2. GroupSelect 컴포넌트의 잘못된 추상화
기존의 `GroupSelect` 컴포넌트는 `GroupSelect - TreeViewContainer - <Fab / Instance / System / Cluster>TreeView` 의 구조였습니다.

이번 요구 사항에서 `Instance, System, Cluster` 가 제거되고 `Site` 가 추가되어야 했습니다. 다만 이 작업 또한 쉽지 않았었습니다. 코드 제거와 추가 만으로 가능할 줄 알았던 작업이 많은 기존 코드 수정을 동반해야 했습니다.

아마 이건 1번과, 추후 이야기할 3번의 영향이 가장 컸을거라 생각하지만 이 컴포넌트에서 아쉬웠던 점 또한 분명 있습니다. 지금 생각해보면 `GroupSelect - TreeViewContainer - Fab / Instance / System / Cluster` 의 구조에서 한 계층이 더 분리되어 나왔다면 좋았겠다는 생각이 들었습니다. `TreeListSelection.tsx, FlatListSelection.tsx` 정도의 컴포넌트를 만들어 도메인에 순수한 UI 컴포넌트를 만들었다면? 더 간결하지 않았을까 하는 생각이 들었습니다.

#### 3. BE에 강하게 요구하지 못했음
기존 응답에 인스턴스의 유니크한 ID 값이 없었습니다.  `InstanceName` 자체가 중복될 수 있었습니다. 이전에 이에 대해 얘기 했고 결론은 적어도 동일 FAB 안에서는 중복되지 않게 필터링 해주겠다 라고 답변 받았고, 부모 이름들을 기반으로 유니크한 ID를 클라이언트에서 직접 생성해서 다루었습니다. 

현재는 요청에 필터를 `dbmsId`라는 유니크한 ID 값 기반으로 flat 한 리스트로 전달하지만, 이 이전에는 트리 구조로 `Fab - Instnace`, `Site - Fab - Instance` 같이 보내주어야 했습니다.

즉 아래와 같은 흐름이 되었습니다:
1. 즉 정리하면 
	1. UI 표현은 트리 구조로 보여줍니다. 여기 까진 괜찮았습니다.
	2. Table 컴포넌트에 필요한 `TableRowData`를 만들때 ID값이 필요합니다. 이 `ID`값을 기반으로 `RowSelection` 상태가 관리되기 때문입니다.
	3. 이를 위해 `<FabName / Cluster / SystemName>:<InstnaceName>` 의 구조로 `ID`를 만든 후 `URIComponent`로 인코딩 시킴. [당시 MR 입니다ㅎㅎ URIComponent를 사용한 이유가 담겨 있습니다!](http://gitlab.exem.xyz/fe1/oracle_license_dashboard/-/merge_requests/38)
	4. 이 ID 값을 기반으로 선택 상태(RowSelection) 값을 관리합니다.
	5. 선택 상태를 필터로 전달할 때 해당 `ID`를 디코딩 한 후, `Fab / Cluster / System Name`을 추출하고, 이를 기반으로 다시 트리 구조로 만듭니다.
	6. 그리고 필터 값으로 보내줍니다.

이게 로직이 Fab, Cluster, System 인 경우 모두 다르고 Instance 기반의 그룹화는 Flat 하다 보니 또 달랐습니다. 결국 `ID`값 하나 없다는게 엄청난 복잡도를 생성했고, 1, 2, 3번이 맞물리며 수정을 아주 어렵게 만들었습니다.

이 문제에 대해서는 인지하고 있었고, 조금 더 강경하게 유니크한 ID 값을 "달라!" 라고 얘기했어야 했다고 생각합니다. 그랬다면 훨씬 더 단순한 구조 덕에 빠르게 변경에 대응할 수 있었을거라 생각합니다.


#### 4. 이외에
- 너무 바이브 탔습니다. 내가 인지하지 못하는 코드의 영역이 내 생각보다 많았고, 그로 인해 코드를 파악하는데 시간이 걸려서 이게 블로커가 되었습니다.
5. 빠르게 작업 하기도 했고, 개인적으로도 큰 사명감을 가지고 일을 하기보단 "빨리 끝내자" 라는 마음으로 작업을 했습니다. 그러다 보니 디테일한 부분들에 대해서 완성도가 많이 떨어졌습니다. 어제 리뷰 받길 잘했다 생각하고 팀원들 덕에 부끄러울 일은 없겠구나 하며 많이 안심하게 되었습니다. 테스트 받길 잘했습니다.
6. 차세대 테이블 컴포넌트 자체도 아직 수정이 필요한 부분들이 정말 많다는걸 느꼈습니다. 그래도 이 작업 하면서 조금 테이블 컴포넌트 자체 완성도도 올라갔다고 생각하긴 합니다. 그래도 한 번 리스트업을 해야겠다고 생각하고 있습니다.

## 만족스러운 점
- 일단 그냥 끝난거 자체가 기분 좋습니다. 속이 다 시원하네요~~
- 오라클 쪽도 API 정의부를 분리해서 관리했는데, 이게 정말 변경에 대응하기 용이했습니다.
- 그거 말고는 잘 했다고 생각 되는 부분이 없습니다....ㅎ 많이 반성하고 있고 열심히 해야겠다는 생각을 했습니다.

---


이번주 SK 하이닉스 대시보드의 마지막 수정 사항을 반영하면서 느낌점을 정리 해보고자 함.

- 변경 사항 대응이 너무 어려웠음
- 버그나 디테일이 부족한 부분들이 너무 많았음

이 두 가지가 이번 주 작업하며 가장 큰 블로커가 되었던 부분들이라고 생각함

이번 변경 사항은 대부분 기능의 추가 였으며, 수정 작업은 필터 정도였음

그런데 이 필터에 대한 수정 작업이 너무나도 오래 걸리고 힘들었음.

## 아쉬웠던 점

1. fab, cluster, system, instance로 groupBy된 리스트들을 하나의 Context Provider가 Suspense Query로 fetch 후 합쳐서 전달하는 구조였음. 즉, Provider의 역할과 책임 그리고 사용 범위가 컸음. 필터의 구조가 Site - Fab - Instance, Fab - Instance 두 가지 구조로 변경되었고, 각 페이지에서 다른 필터를 사용해야 하게 되었음. 그러다 보니 Provider를 완전 분리해 독립된 2가지의 Provider로 만들어야 했고, 이에 대한 작업의 범위 및 영향이 컸음.
2. TreeView의 잘못된 추상화. GroupSelect - TreeViewContainer - Fab / Instance / System 의 구조였음. 지금 생각해보면 GroupSelect - TreeViewContainer - Fab / Instance / System / Cluster 의 구조에서 하나가 더 분리되어 나왔다면 좋았겠다는 생각이 듬. TreeListSelection.tsx, FlatListSelection.tsx 정도가 될거 같음. Fab / Instance / System이 이 일반화된 UI를 사용하는 형태가 될거 같음. 아마 Cluster, System, Instance를 제거하고 Site를 추가하는 작업에 도움이 되었을거라 생각함
3. 인스턴스의 유니크한 ID 값이 없었음.  InstanceName 자체가 중복될 수 있었음. 그래서 이 작업 이전에는 적어도 동일 FAB 안에서는 중복되지 않게 필터링 해주겠다 라고 답변 받았고, 부모 이름들을 기반으로 유니크한 ID를 직접 생성해서 다루었음. 거기다가 현재는 필터를 `dbmsId`라는 유니크한 ID 값 기반으로 flat 한 리스트로 전달하지만, 이 이전에는 트리 구조 Fab - Instnace, Site - Fab - Instance 구조로 보내주어야 했음.
	1. 즉 정리하면 
		1. UI 표현은 트리 구조로 진행
		2. ID값을 `<FabName / Cluster / SystemName>:<InstnaceName>` 의 구조로 만든 우 URIComponent로 인코딩 시킴. [당시 MR](http://gitlab.exem.xyz/fe1/oracle_license_dashboard/-/merge_requests/38)
		3. 이 ID 값을 기반으로 선택 상태(RowSelection) 값을 관리
		4. 선택 상태를 필터로 전달할 때 해당 ID를 디코딩 한 후, Fab / Cluster / System Name을 추출하고, 이를 기반으로 트리 구조로 만듬
		5. 그리고 필터 값으로 보내줌
	2. 인스턴스 리스트에 유니크한 값이 필요하며, 이게 없어 발생하는 불필요한 복잡성에 대해서 인지 해왔고 얘기 했지만 조금 더 강경하게 "달라!" 라고 얘기 했어야 했다고 생각함. 그랬다면 훨씬 단순한 구조 덕에 수정이 용이했을 거라 생각함. 뒤늦게 이러한 것들을 반영하게 되면서 작업이 상상 이상으로 컸음.
4. 너무 바이브 탔음. 내가 인지하지 못하는 코드의 영역이 내 생각보다 많았고, 그로 인해 코드를 파악하는데 시간이 걸려서 이게 블로커가 되었음.
5. 빠르게 작업 하기도 했고, 개인적으로도 큰 사명감을 가지고 일을 하기보단 "빨리 끝내자" 라는 마음으로 작업을 했음. 그러다 보니 디테일한 부분들에 대해서 완성도가 많이 떨어졌음. 어제 리뷰 받길 잘했다 생각하고 팀원들 덕에 부끄러울 일은 없겠구나 하며 많이 안심하게 되었음. 테스트 받길 잘했음.
6. 차세대 테이블 컴포넌트 자체도 아직 수정이 필요한 부분들이 정말 많다는걸 느낌. 그래도 이 작업 하면서 조금 테이블 컴포넌트 자체 완성도도 올라갔다고 생각하긴 함. 그래도 한 번 리스트업을 해야겠다고 생각하고 있음.

## 만족스러웠던 점
- 일단 그냥 끝난거 자체가 기분 좋음. 속이 다 시원함.
- 오라클 쪽도 API 정의부를 분리해서 관리했는데, 이게 정말 변경에 대응하기 용이했음.
- 그거 말고는 잘 했다고 생각 되는 부분이 없음. 많이 반성하고 있음. 열심히 해야겟음.
