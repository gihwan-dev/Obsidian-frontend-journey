# 검색 성능 개선

#resume-with-ai #즉시 #성능 #AI

## 요약
서브 모듈 기반 로컬 파일 검색(searchDocuments)의 검색 품질 및 성능을 개선한다.

## 왜?
- 현재 `searchDocuments()`는 단순 키워드 substring 매칭(`String.includes`)으로 동작하여 검색 정확도가 낮음
- 매 검색마다 전체 카탈로그를 순회하며 `.toLowerCase()` + `.includes()` 반복 — O(n × m) 비효율
- 유의어, 부분 일치, 형태소 변환 등 고급 검색 기능이 전혀 없음
- AI 에이전트의 tool-calling 품질이 검색 결과 품질에 직접적으로 의존

## 어떻게?
구체적인 접근 방법은 구현 시 결정. 고려할 수 있는 옵션:
1. **역인덱스 + TF-IDF**: 빌드 타임에 역인덱스를 생성하고 TF-IDF 기반 랭킹 적용
2. **경량 전문 검색 라이브러리**: Fuse.js, MiniSearch 등 도입
3. **벡터 임베딩 검색**: Vertex AI Embedding 등을 활용한 시맨틱 검색
4. **빌드 타임 전처리 강화**: `build-vault.mjs`에서 인덱스를 사전 구축

## 예상 효과
- 검색 정확도 향상 → AI 에이전트의 답변 품질 개선
- 검색 응답 시간 단축
- 유의어/관련 키워드 매칭으로 검색 커버리지 확대

## 작업 로그

### 2026-02-08
**상태**: 완료

**작업 내용**:
- MiniSearch(BM25 기반) 도입으로 기존 `String.includes()` substring 검색을 풀텍스트 검색으로 교체
- 퍼지매칭, 접두어 검색, 본문 검색 지원 추가
- `build-vault.mjs`에 MiniSearch 인덱스 빌드 단계 추가 (`search-index.json` 생성)
- 벤치마크 스크립트 작성 (`search-benchmark.mjs`)으로 성능 측정 자동화
- 단위 테스트 10개 추가 (`obsidian-search.test.ts`)
- PR #46 머지 완료

**변경 파일**:
- `web/scripts/build-vault.mjs` - MiniSearch 인덱스 빌드 로직 추가
- `web/scripts/search-benchmark.mjs` - 검색 품질 벤치마크 스크립트 신규 생성
- `web/src/lib/work-agent/obsidian.server.ts` - searchDocuments()를 MiniSearch 기반으로 교체
- `web/src/lib/work-agent/tools.ts` - 검색 도구 설명 업데이트
- `web/tests/lib/work-agent/obsidian-search.test.ts` - MiniSearch 검색 단위 테스트 추가
- `web/tests/lib/work-agent/source-tracker.test.ts` - 소스 트래커 테스트 보강
- `web/tests/lib/work-agent/tools.test.ts` - 도구 테스트 업데이트
- `web/biome.json` - vault/ 서브모듈 ignore 추가

**성과 지표**:
- Hit@10: 75% → 85% 개선
- Fuzzy 매칭: 40% → 80% 개선

## 연관 이슈
- [[서버 측 캐싱 추가]] - 검색 성능 개선과 함께 `obsidian.server.ts`를 공유하며, 캐싱 적용 시 검색 결과 캐싱도 고려 가능
