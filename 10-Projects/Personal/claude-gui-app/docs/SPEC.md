# Claude GUI App — 제품 스펙 문서 (v1)

> Claude Code의 기능을 그대로 드러내면서, 더 간단하게 관리하고 사용할 수 있도록 확장하는 macOS 네이티브 GUI 애플리케이션

---

## 1. 기술 스택

| 영역 | 기술 | 비고 |
|------|------|------|
| 앱 프레임워크 | Tauri v2 | Rust 백엔드 + WebView 프론트엔드 |
| 프론트엔드 | React + TypeScript | - |
| 터미널 임베드 | xterm.js | WebView 내에서 렌더링 |
| PTY 관리 | Rust (portable-pty 등) | 터미널 세션 생명주기 관리 |
| Claude Code 연동 | CLI subprocess | JSON stream 파싱 (`--output-format stream-json`) |
| 타겟 플랫폼 | macOS only | - |

### 연동 아키텍처

```
┌─────────────────────────────────────────────┐
│  Tauri App (macOS)                          │
│                                             │
│  ┌──────────────────┐  ┌─────────────────┐  │
│  │  React/TS UI     │  │  Rust Backend   │  │
│  │                  │  │                 │  │
│  │  xterm.js ◄──────┼──┤  PTY Manager    │  │
│  │  워크플로우 에디터 │  │  Git 관리       │  │
│  │  설정 패널       │  │  세션 관리       │  │
│  │  모니터링 대시보드│  │  파일 시스템     │  │
│  └──────────────────┘  └────────┬────────┘  │
│                                 │            │
│                    ┌────────────▼──────────┐ │
│                    │  Claude Code CLI      │ │
│                    │  (subprocess)         │ │
│                    │  JSON stream 파싱     │ │
│                    └──────────────────────┘  │
└─────────────────────────────────────────────┘
```

- Claude Code CLI를 subprocess로 실행하여 모든 기본 기능(MCP, 권한 시스템, 세션 관리 등)을 그대로 활용
- CLI의 structured output(JSON stream)을 파싱하여 GUI에 반영
- Git 조작, 파일 시스템 관리 등 확장 기능은 Rust 백엔드에서 직접 처리

---

## 2. 세션 관리

### 2.1 프로젝트 기반 세션

- 모든 작업은 **프로젝트 단위**로 관리
- 프로젝트 = Git 저장소 기반

### 2.2 워크트리 기반 격리

- 모든 세션 생성 시 **git worktree** 자동 생성
- 각 세션은 독립된 워크트리에서 작업 → 메인 브랜치 오염 없음
- 세션 종료/삭제 시 워크트리 정리 옵션

### 2.3 Bypass 모드 기본 적용

- 세션은 기본적으로 **bypass 모드**로 생성 (사용자 확인 없이 실행)
- 독립된 워크트리 + 체크포인트 시스템으로 안전성 확보
- **금지 커맨드 정책**을 통해 위험한 bash 명령어 관리

### 2.4 세션 생성 시 설정 항목

| 설정 | 설명 |
|------|------|
| 모델 선택 | Opus / Sonnet 등 모델 지정 |
| MCP 선택 | 이번 세션에 포함할 MCP 서버 체크박스 선택 |
| 스킬 선택 | 전역/로컬 스킬 중 이번 세션에 적용할 스킬 선택 |
| 정책 설정 | 금지 bash 커맨드 등 보안 정책 |

### 2.5 다중 세션

- 여러 세션을 동시에 실행 가능
- AskQuestion 등 사용자 입력 필요 시 해당 세션으로 **자동 포커스 이동**

---

## 3. 체크포인트 시스템

### 3.1 개념

- 세션 내에서 사용자가 **원하는 시점에 커밋(체크포인트)을 생성**
- 체크포인트 = git commit, 롤백의 기준점

### 3.2 핵심 기능

- **체크포인트 생성**: 단축키로 현재 상태를 커밋
- **롤백**: 특정 체크포인트로 되돌리기 → 프롬프트 재시도 가능
- **체크포인트 간 diff**: 시각적 변경사항 비교
- **타임라인 뷰**: 체크포인트 히스토리를 타임라인으로 시각화

### 3.3 Git 통합

- 세션 완료 후 → PR 자동 생성 옵션
- 브랜치 관리 / 커밋 메시지 자동 생성
- 워크트리 정리(cleanup) 자동화

---

## 4. 무한 루프 모드

### 4.1 실행 구조

```
[루프 시작]
  → 프롬프트 실행 (Claude Code 세션)
  → 자동 커밋 (체크포인트 생성)
  → 종료 판단
  → 다음 사이클 또는 루프 종료
[루프 종료]
```

### 4.2 종료 모드 (선택 가능)

| 모드 | 설명 |
|------|------|
| 수동 중지 | 사용자가 직접 중지할 때까지 반복 |
| 자동 완료 | Claude가 "더 이상 할 것 없음" 판단 시 자동 종료 |

### 4.3 완료 기준 설정 (자동 완료 모드)

- **자연어 기준**: "타입 에러가 0개가 될 때까지", "모든 함수가 20줄 이하가 될 때까지"
- **커맨드 기준**: 매 사이클 후 특정 커맨드 실행 결과로 판단 (예: `tsc --noEmit` 에러 0이면 종료)
- **Claude 자율 판단**: "더 개선할 것 없다고 판단되면 종료해"
- 위 기준들을 **조합 가능**

### 4.4 부가 기능

- **사이클 카운터 + 상한**: 안전장치, 비용 폭주 방지
- **사이클별 diff 요약**: 매 사이클 변경사항 한눈에 확인
- **일시정지 / 재개**: 중간 확인 후 다시 실행
- **컨텍스트 누적**: 이전 사이클 결과를 반영하여 다음 사이클 프롬프트 자동 보강

---

## 5. 워크플로우 시스템

### 5.1 n8n 스타일 비주얼 노드 에디터

워크플로우를 노드 기반으로 시각적으로 구성.

### 5.2 노드 타입

| 노드 | 설명 |
|------|------|
| **세션 노드** | Claude Code 세션 실행. 프롬프트, 모델, 스킬, MCP 설정 포함 |
| **조건 노드** | 이전 노드의 출력 기반 분기 처리 |
| **루프 노드** | 무한 루프 모드 컨테이너 |
| **트리거 노드** | 워크플로우 시작 조건 (수동, 스케줄, 파일 변경 감지 등) |
| **Git 노드** | 커밋, 체크포인트, PR 생성 등 git 작업 |
| **알림 노드** | 사용자 확인 요청, 중간 리뷰 포인트 |

### 5.3 세션 간 컨텍스트 전달

- 세션 종료 시 **자동 compact 실행**
- compact 결과(요약본)를 다음 노드의 초기 프롬프트에 주입
- 조건 노드에서도 compact 결과를 파싱하여 분기 판단에 활용

```
세션 A 완료 → 자동 compact → 요약본 추출
  → 세션 B 시작 프롬프트:
    "이전 작업 요약: {compact_result}
     이번 작업: {세션B 프롬프트}"
```

### 5.4 워크플로우 예시

```
[트리거: 수동 실행]
  → [세션: 기능 구현] "로그인 페이지 만들어줘"
  → [Git: 체크포인트]
  → [루프: 리팩토링]
      완료 기준: tsc --noEmit 에러 0
      매 사이클 자동 커밋
  → [Git: 체크포인트]
  → [세션: 테스트 작성] "방금 만든 코드에 대한 테스트 작성해"
  → [조건: 테스트 통과?]
      ├─ Yes → [Git: PR 생성]
      └─ No  → [세션: 버그 수정] → (조건으로 되돌아감)
```

### 5.5 워크플로우 저장 / 공유

- **JSON 포맷**으로 직렬화하여 저장
- 개인 라이브러리에서 프로젝트 간 재사용
- 내보내기 / 가져오기로 외부 공유
- **변수(플레이스홀더)** 지원: `{{target_dir}}`, `{{feature_name}}` 등으로 범용 템플릿화

---

## 6. 모니터링

### 6.1 토큰 / 비용 추적

- 세션별, 프로젝트별, 일/주/월 단위 사용량 및 비용 표시
- **예산 상한선 설정** + 경고 알림
- 무한 루프 / 워크플로우 실행 중 실시간 비용 표시

### 6.2 컨텍스트 윈도우 시각화

- 현재 컨텍스트 점유율 시각적 표시
- 파일별 / 요소별 비중 표시
- 컨텍스트 overflow 사전 경고

### 6.3 스킬 사용 모니터링

- 현재 세션에 로드된 스킬 목록 표시
- 어떤 스킬이 실제로 호출/사용되고 있는지 추적
- 스킬별 사용 빈도 통계

---

## 7. 설정 관리 GUI

### 7.1 2단계 설정 구조

| 레벨 | 범위 | 저장 위치 |
|------|------|----------|
| 전역 설정 | 모든 프로젝트에 적용 | 앱 설정 디렉토리 |
| 로컬 설정 | 특정 프로젝트에만 적용 | 프로젝트 루트 |

### 7.2 관리 가능 항목

- **정책 관리**: 금지 bash 커맨드 목록, bypass 모드 설정
- **MCP 서버 관리**: 설치 / 활성화 / 비활성화 GUI
- **스킬 관리**: 전역 / 로컬 단위 추가 / 제거 / 편집
- **모델 기본값**: 기본 사용 모델 설정
- **알림 설정**: 알림 종류 / 사운드 / 트레이 배지 등

---

## 8. 파일 & 컨텍스트 관리

- **프로젝트 파일 트리** 표시 (사이드바)
- 컨텍스트에 포함할 파일을 **체크박스로 관리**
- **CLAUDE.md** GUI 편집기 내장

---

## 9. 세션 히스토리

- 과거 세션 **검색** (키워드, 프로젝트, 날짜 기준)
- 세션 **북마크** / **태깅**
- 세션 결과 요약 미리보기

---

## 10. UX / 인터랙션

### 10.1 단축키 중심 조작

- 모든 주요 기능에 단축키 매핑
- 커맨드 팔레트 (Cmd+K 등) 지원

### 10.2 알림 시스템

| 이벤트 | 동작 |
|--------|------|
| AskQuestion 발생 | 해당 세션 자동 포커스 + 시스템 알림 |
| 다중 세션 중 입력 필요 | 자동 세션 전환 |
| 장시간 작업 완료 | macOS 알림 센터 + 사운드 |
| 비용 상한 도달 | 경고 알림 + 일시정지 |

### 10.3 테마

- Claude 브랜드 테마 (베이지/오렌지 톤 기반)

---

## 11. 향후 고려 사항 (미확정)

- 커뮤니티 워크플로우 템플릿 마켓플레이스
- 멀티 모델 동시 비교 실행
- 팀 단위 설정 공유 / 동기화
- 플러그인 시스템

---

*문서 버전: v1 — 2025.02.08*
*상태: 스펙 초안, 구현 미착수*
