브라우저 별로 스레드를 많이 사용하는 프로세스를 하나만 사용할 수 있고, 스레드를 조금만 사용하는 프로세스를 여러 개 만들어 IPC로 통신할 수도 있다.

![[Pasted image 20241128103400.png]]
**서로 다른 브라우저 아키텍처의 프로세스와 스레드**

브라우저를 만드는 방법에 대한 표준은 없다. 브라우저마다 접근 방식이 완전히 다를 수 있다.

Chrome은 사이트(`iframe`에 있는 사이트 포함)마다 프로세스를 할당한다.

![[Pasted image 20241128104645.png]]

- 탭: 각 탭의 웹 페이지 컨텐츠를 처리하는 독립적인 렌더러 프로세스
	- 예) 네이버와 구글을 각각 다른 탭으로 열었을 때
- 전용 작업자: 웹 페이지의 백그라운드 작업을 처리하는 별도의 프로세스
	- 예) 웹 메일에서 대용량 첨부파일 업로드 처리
- 서브 프레임: 메인 페이지 내의 독립적인 프레임을 처리하는 프로세스
	- 예) 페이스북 페이지에 임베드된 유튜브 영상 플레이어

[크롬 프로세스 모델](https://chromium.googlesource.com/chromium/src/+/main/docs/process_model_and_site_isolation.md)을 참고하면 프로세스 할당에 대해 좀 더 자세히 알 수 있다.

## 어떤 프로세스가 무엇을 담당하는지

| 프로세스      | 프로세스가 제어하는 부분                                                                                          |
| --------- | ------------------------------------------------------------------------------------------------------ |
| 브라우저 프로세스 | 주소 표시줄, 북마크 막대, 뒤로가기 버튼, 앞으로 가기 버튼 등 UI 백엔드 부분을 제어한다. 네트워크 요청이나 파일 접근과 같이 눈에 보이지 않지만 권한이 필요한 부분도 처리한다. |
| 렌더러 프로세스  | 탭 안에서 웹 사이트가 표시되는 부분의 모든 것을 제어한다.                                                                      |
| GPU 프로세스  | GPU 작업을 다른 프로세스와 격리해서 처리한다.                                                                            |
| 플러그인 프로세스 | 웹 사이트에서 사용하는 플러그인을 제어한다.                                                                               |


![[Pasted image 20241128110413.png]]

실제로 작업 프로세스를 보면

![[Pasted image 20241128110513.png]]

브라우저와 GPU 프로세스는 하나만 존재한다.

## 다중 프로세스 아키텍처의 이점

3개의 탭이 열려있다고 생각해보자.

하나의 프로세스를 사용하면 한 탭이 응답하지 않으면 나머지 모든 탭이 응답하지 못한다.

**프로세스 하나만 사용하는 경우**
![[Pasted image 20241128111403.png]]

**탭마다 프로세스를 사용하는 경우**
![[Pasted image 20241128111437.png]]

또 다른 이점은 보안과 격리다. 운영체제를 통해 프로세스의 권한을 제한할 수 있다. 예를 들어 렌더러 프로세스는 파일에 접근할 수 없다.

프로세스는 전용 메모리 공간을 사용하기 때문에 공통부분을 복사해서 가지고 있는 경우가 많다. 예를들어 각 탭의 렌더러 프로세스는 V8 엔진 인스턴스를 각각 메모리에 보유하고 있다. 크롬은 메모리 절약을 위해 실행할 수 있는 프로세스의 개수를 제한한다. 기기에 따라 다르지만 한도에 다다르면 동일한 사이트를 열고 있는 여러 탭을 하나의 프로세스에서 처리한다.

## 메모리 절약

크롬은 브라우저의 각 부분을 서비스로 실행해 여러 프로세스로 쉽게 분할하거나 하나의 프로세스로 통합할 수 있도록 아키텍처를 구성하고 있다.

성능이 좋은 기기에서는 각 서비스를 여러 프로세스로 분할해(브라우저 프로세스 -> 네트워크, 브라우저, UI, 스토리지, 디바이스 프로세스로 분할됨) 안정성을 높이고, 리소스가 제한적인 경우 여러 서비스를 하나의 브라우저 서비스로 합치는 방식으로 메모리를 절약한다.

## 프레임별로 실행되는 렌더러 프로세스 - 사이트 격리

`iframe`의 사이트를 별도의 렌더러 프로세스가 실행하는 것을 사이트 격리라 한다. 탭마다 렌더러 프로세스를 할당하는 경우 `iframe`의 사이트가 같은 렌더러 프로세스에서 작동하기 때문에 메모리를 공유할 수 있다는 문제가 있다. 크롬은 이를 해결하기 위해 사이트별 렌더러 프로세스를 적용한다.
