문서 파싱: 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것. 파싱 결과는 보통 노드 트리다. 이를 파싱 트리(parse tree) 또는 문법 트리(syntax tree)라고 부른다.

## 문법

파싱은 문서에 작성된 언어 또는 형식의 규칙을 따른다(HTML, XML, JSON). 이것을 [[문맥 자유 문법]]이라고 한다.

## 파서-어휘 분석기 조합

파싱은 어휘 분석과 구문 분석이라는 두 가지로 구분할 수 있다.

**어휘 분석:** 자료를 토큰으로 분해하는 과정. 유효하게 구성된 단위의 집합체.
**구문 분석:** 언어의 구문 규칙을 적용하는 과정.

파싱을 위해 필요한 도구는 다음 두가지 이다.

- 자료를 유효한 토큰으로 분해하는 **어휘 분석기(토큰 변환기라고도 부른다)**
- 언어 구문 규칙에 따라 문서 구조를 분석함으로써 파싱 트리를 생성하는 **파서**

어휘 분석기는 공백과 줄 바꿈 같은 의미 없는 문자를 제거한다.
![[Pasted image 20241129174717.png]]
파싱은 다음 과정을 계속해서 반복한다.

1. 파서는 어휘 분석기로부터 새 토큰을 받아 구문 규칙과 일치하는지 확인한다.
2. 규칙에 맞으면 파싱 트리에 노드를 추가하고, 또 다른 토큰을 요청한다.
3. 맞지 않으면, 내부적으로 저장하고 일치하는 규칙이 발견될 때까지 요청한다. 없다면 예외 처리한다.

## 변환

파서 트리는 최종 결과물이 아니다. 파싱은 보통 문서를 다른 양식으로 변환한다. 컴파일이 하나의 예가 될 수 있다. 컴파일러는 소스 코드를 통해 파싱 트리를 생성하고 이를 기계 코드 문서로 변환한다.

## 파싱 예

간단한 수학 언어를 정의하고 파싱 과정을 살펴 보자.

**어휘**: 정수, 더하기 기호, 빼기 기호를 포함한다.

**구문**:
1. 언어 구문의 기본적인 요소는 표현식, 항, 연산자이다.
2. 표현식의 수는 제한이 없다.
3. 표현식은 "항" 뒤에 "연산자" 그 뒤에 또 다른 항이 따르는 형태로 정의한다.
4. 연산자는 더하기 또는 빼기 토큰이다.
5. 정수 토큰 또는 하나의 표현식은 항이다.

2 + 3 + 1을 분석해보자.

![[Pasted image 20241129174532.png]]

`2 + 3 + 1`은 유효한 표현식이 된다. 반면에 `2++`와 같은 표현식은 조건에 부합하지 않기 때문에 유효하지 않은 입력이 된다.

## 어휘와 구문에 대한 공식적인 정의

어휘는 보통 **정규표현식**으로 표현한다. 이전 수학 표현식을 예로들면 다음과 같다.

```js
INTEGER : 0|[1-9][0-9]*
PLUS : +
MINUS : -
```

구문은 보통 [[BNF]] 라고 부르는 형식에 따라 정의한다. 다음과 같이 정의할 수 있다.

```text
expression := term operation term
operation := PLUS | MINUS
term := INTEGER | expression
```

문법이 [[문맥 자유 문법]]이라면 언어는 정규 파서로 파싱할 수 있다. 문맥 자유 문법을 쉽게 말하면 완전히 BNF로 표현 가능한 문법이다.

## 파서의 종류

- **상향식 파서**: 낮은 수준에서 점차 높은 수준으로 찾는다.
- **하향식 파서**: 구문의 상위 구조로부터 일치하는 부분을 찾기 시작한다.

수학 표현식 `2 + 3 - 1`을 예로 사용해 알아보자.

### 하향식 파서

`2 + 3`과 같은 표현식에 해당하는 높은 수준의 규칙을 찾는다. 이후 `2 + 3 - 1`을 찾는다.

![[Pasted image 20241129174624.png]]

### 상향식 파서

입력 값이 규칙에 맞을 때까지 찾아서 맞는 입력 값을 규칙으로 바꾼다. 이 과정은 입력 값을 끝까지 진행된다. 부분적으로 일치하는 표현식은 파서 스택에 쌓인다.

상향식 파서에서 `2 + 3 - 1` 수식을 처리한다면 대략 이런 과정을 거친다.


|  스택   |    입력     |         동작          |
| :---: | :-------: | :-----------------: |
|       | 2 + 3 - 1 |                     |
|   2   |  + 3 - 1  |        shift        |
|  2 +  |   3 - 1   |        shift        |
| 2 + 3 |    - 1    | reduce (2 + 3 -> 5) |
|   5   |    - 1    |        shift        |
|  5 -  |     1     |        shift        |
| 5 - 1 |           | reduce (5 - 1 -> 4) |
|   4   |           |       accept        |

## 파서 자동 생성

파서를 생성해 줄 수 있는 도구를 파서 생성기라고 한다. 언어에 어휘나 구문 규칙 같은 문법을 부여하면 동작하는 파서를 만들어 준다.

웹킷은 `Flex`와 `Bison`이라는 두 개의 파서 생성기를 사용한다.