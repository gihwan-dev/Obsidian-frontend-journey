## 버퍼 캐시 (Buffer Cache) 기본 개념
### 1. **버퍼 캐시란?**
**정의:**
- SGA(System Global Area) 내의 메모리 영역
- **디스크의 데이터 블록을 메모리에 캐싱**하는 공간
- 디스크 I/O를 줄여 성능 향상

```
애플리케이션 요청
    ↓
버퍼 캐시 확인
    ↓
있음? → Cache Hit (빠름) ✅
없음? → Cache Miss (디스크 읽기) ❌
```

---
## 2. **블록의 상태 (Block Status)**
버퍼 캐시의 블록은 다음 상태를 가져요:
### **주요 상태 3가지**

| 상태         | 설명             | 특징              |
| ---------- | -------------- | --------------- |
| **Clean**  | 디스크와 동일        | 언제든 덮어써도 됨      |
| **Dirty**  | 수정되었지만 디스크 미반영 | DBWR이 디스크에 써야 함 |
| **Pinned** | 현재 사용 중        | 다른 프로세스가 접근 불가  |

---
## 3. **블록의 종류 (Block Mode)**
### **Current Block vs CR Block**
```
Current Block (현재 블록)
- 가장 최신 버전
- DML 작업 시 사용
- "지금 이 순간"의 데이터

CR Block (Consistent Read Block)
- 특정 시점의 읽기 일관성 버전
- SELECT 시 사용
- Undo 데이터로 재구성
- 과거의 "스냅샷"
```

**예시:**
```sql
-- Transaction 1이 UPDATE 실행 중
UPDATE emp SET sal = 5000 WHERE empno = 100;
-- Current Block: sal = 5000 (커밋 전)

-- Transaction 2가 SELECT 실행
SELECT sal FROM emp WHERE empno = 100;
-- CR Block: sal = 4000 (이전 값, 읽기 일관성)
```

---
## 4. **버퍼 캐시 구조**
### **LRU (Least Recently Used) 리스트**
```
Hot End (자주 사용)
    ↑
[Block A] → 방금 사용
[Block B] → 최근 사용
[Block C]
    ...
[Block Z] → 오래됨
    ↓
Cold End (교체 대상)
```

**동작 방식:**
1. 새 블록 필요 → Cold End에서 교체 대상 찾기
2. 블록 사용 → Hot End로 이동
3. Dirty 블록 → DBWR이 디스크에 쓰기

---

## 5. **MFO 모니터링 관점**
### **핵심 지표**
**Buffer Cache Hit Ratio:**
```
Hit Ratio = (1 - Physical Reads / Logical Reads) × 100
목표: 95% 이상
```

**주요 대기 이벤트:**
```sql
db file sequential read   -- 단일 블록 읽기
db file scattered read    -- 다중 블록 읽기 (Full Scan)
free buffer waits         -- 빈 버퍼 부족
buffer busy waits         -- 블록 경합
```
### **UI 표시 요소**
**실시간 대시보드:**
- Buffer Cache Hit Ratio (게이지 차트)
- Physical vs Logical Reads (라인 차트)
- Dirty Buffer 비율 (진행률 바)
- 대기 이벤트 Top 10 (테이블)

**Alert 임계값 예시:**
```javascript
{
  bufferCacheHitRatio: { 
    warning: 90,  // 90% 미만 경고
    critical: 85  // 85% 미만 심각
  },
  freeBufferWaits: {
    warning: 100,  // 100회/초 이상
    critical: 500
  }
}
```

---

## 6. **성능 문제 시나리오**
### **Case 1: Cache Miss 과다**
```
증상: Physical Read 급증
원인: 버퍼 캐시 크기 부족, Full Scan 과다
해결: db_cache_size 증가, SQL 튜닝
```

### **Case 2: Dirty Buffer 과다**
```
증상: Free Buffer Waits 발생
원인: DBWR이 쓰기 속도 따라가지 못함
해결: DBWR 프로세스 증가, 디스크 I/O 개선
```

---

## 요약
**버퍼 캐시 = 디스크 블록의 메모리 캐시**
- Clean/Dirty/Pinned 상태 관리
- Current/CR 두 가지 버전 유지
- LRU 알고리즘으로 교체 관리
- Hit Ratio가 핵심 성능 지표