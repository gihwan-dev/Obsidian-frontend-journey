## 비트맵 인덱스(Bitmap Index)란?

비트맵 인덱스는 **낮은 카디널리티(Low Cardinality)** 컬럼, 즉 중복값이 많은 컬럼에 최적화된 인덱스 구조입니다.

### 일반 B-Tree 인덱스와의 차이

**B-Tree 인덱스:**

```
성별 컬럼의 경우
'M' → ROWID1
'M' → ROWID2  
'F' → ROWID3
'M' → ROWID4
...각 값마다 개별 엔트리
```

**Bitmap 인덱스:**

```
'M' → 1101001... (비트맵)
'F' → 0010110... (비트맵)

비트 위치가 ROWID를 표현
1 = 해당 값을 가짐
0 = 해당 값을 가지지 않음
```

### 왜 Shared Lock이 발생하는가?

비트맵 인덱스는 **하나의 인덱스 엔트리가 여러 로우를 표현**합니다. 예를 들어:

```
성별='M'인 비트맵 엔트리 하나가 
수천~수만 개의 로우를 표현
```

따라서 **한 사용자가 성별='M'인 로우 하나만 INSERT/UPDATE/DELETE 해도, 그 비트맵 엔트리 전체를 수정**해야 합니다.

이 때 다른 트랜잭션도 같은 비트맵 엔트리를 수정하려고 하면:

- 동일한 비트맵 블록에 동시 접근
- `Shared` 모드 TX Lock 경합 발생
- 직렬화(Serialization) 필요

### 모니터링 관점에서의 의미

**비트맵 인덱스로 인한 경합 특징:**

1. **범위가 넓음**: 실제로는 다른 로우를 수정하는데도 Lock 경합 발생
2. **동시성 저하**: OLTP 환경에서는 치명적
3. **DW/배치 환경에 적합**: 주로 읽기 위주, 대량 배치 작업에 유리

**대시보드 설계 시 고려사항:**

- `enq: TX - row lock contention`의 Lock Mode를 표시 (Exclusive vs Shared)
- Shared 모드가 지배적이면 → Unique 제약 또는 비트맵 인덱스 의심
- 해당 테이블의 인덱스 타입 정보와 연계하여 표시
- 비트맵 인덱스가 있는 테이블에서 높은 DML 동시성이 감지되면 경고

이런 정보가 모니터링 UI에 잘 표현되면 DBA가 "아, 이 테이블은 비트맵 인덱스 때문에 동시성 문제가 있구나"라고 빠르게 파악할 수 있습니다.