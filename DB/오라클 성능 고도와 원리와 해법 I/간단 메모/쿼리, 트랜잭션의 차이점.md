## 쿼리 (Query/Statement)

**하나의 SQL 문장 = 하나의 쿼리**

```sql
SELECT * FROM employees WHERE dept_id = 10;  -- 쿼리 1개

UPDATE employees SET salary = salary * 1.1;  -- 쿼리 1개

INSERT INTO log VALUES (1, 'test');          -- 쿼리 1개
```

세미콜론(`;`)으로 구분되는 각각의 SQL 문이 하나의 쿼리입니다. CRUD 작업을 수행하는 독립적인 명령문이죠.

## 트랜잭션 (Transaction)

**논리적인 작업 단위 = 하나 이상의 쿼리 묶음**

### 1. 명시적 트랜잭션 (Explicit Transaction)

```sql
-- SQL Server, PostgreSQL, MySQL 등
BEGIN TRANSACTION;  -- 또는 START TRANSACTION;
  UPDATE account SET balance = balance - 10000 WHERE id = 'A';
  UPDATE account SET balance = balance + 10000 WHERE id = 'B';
COMMIT;  -- 또는 ROLLBACK;
```

### 2. Oracle의 경우 (약간 특이함!)

Oracle은 `BEGIN TRANSACTION` 문법이 **없습니다**. 대신:

```sql
-- 트랜잭션이 자동으로 시작됨 (첫 DML 실행 시)
UPDATE account SET balance = balance - 10000 WHERE id = 'A';  -- 트랜잭션 시작!
UPDATE account SET balance = balance + 10000 WHERE id = 'B';  -- 같은 트랜잭션 내
INSERT INTO log VALUES (...);                                 -- 같은 트랜잭션 내

COMMIT;  -- 트랜잭션 종료 (성공)
-- 또는 ROLLBACK; -- 트랜잭션 종료 (취소)
```

**트랜잭션 시작 시점:**

- 첫 번째 `INSERT`, `UPDATE`, `DELETE`, `SELECT FOR UPDATE` 실행 시
- 이전 트랜잭션이 COMMIT/ROLLBACK으로 종료된 직후

**트랜잭션 종료 시점:**

- `COMMIT` 실행
- `ROLLBACK` 실행
- DDL 문 실행 (자동 COMMIT)
- 세션 종료

### 3. Auto-commit 모드

많은 DB 클라이언트와 JDBC는 기본적으로 **auto-commit 모드**:

```sql
-- auto-commit ON 상태
UPDATE account SET balance = 1000 WHERE id = 'A';  
-- 자동으로 COMMIT됨 (트랜잭션 시작 → 실행 → 즉시 종료)

UPDATE account SET balance = 2000 WHERE id = 'B';  
-- 별도의 새 트랜잭션 (시작 → 실행 → 즉시 종료)
```

각 쿼리가 독립적인 트랜잭션이 됩니다.

```sql
-- auto-commit OFF 상태
UPDATE account SET balance = 1000 WHERE id = 'A';  -- 트랜잭션 시작
UPDATE account SET balance = 2000 WHERE id = 'B';  -- 같은 트랜잭션
COMMIT;  -- 명시적으로 종료해야 함
```

## 모니터링 관점에서

MFO에서 확인할 수 있는 지표들:

```
Active Transactions:
├─ Transaction ID: 12345
│  ├─ Started: 14:30:25
│  ├─ Duration: 00:05:32
│  └─ Statements executed: 15개
│
├─ Transaction ID: 12346
   ├─ Started: 14:35:40
   ├─ Duration: 00:00:03
   └─ Statements executed: 1개
```

- **Long Transaction**: 여러 쿼리를 실행하면서 COMMIT을 오래 안 한 경우
- **Undo 사용량**: 트랜잭션이 길어질수록 증가
- **Lock 대기**: 트랜잭션이 Lock을 잡고 있는 동안 다른 세션이 대기

---

**요약:**

- ✅ **쿼리** = 하나의 SQL 문장 (`;`으로 구분)
- ✅ **트랜잭션** = BEGIN ~ COMMIT 사이 (또는 Oracle은 첫 DML ~ COMMIT)
- ✅ 하나의 트랜잭션에 여러 쿼리가 포함될 수 있음
- ✅ Auto-commit 모드에서는 쿼리 하나가 트랜잭션 하나가 될 수도 있음
