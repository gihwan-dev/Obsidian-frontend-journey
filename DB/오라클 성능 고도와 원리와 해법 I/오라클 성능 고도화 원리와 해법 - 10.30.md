## 오라클 성능 관리
- 쿼리 성능에 문제가 생기면 Explain Plan을 통해 실행계획을 먼저 확인
- 그것만으로 정확히 파악할 수 없을 때는 AutoTrace를 걸어 실제 일량을 측정하거나, SQL 트레이스를 걸어 내부 수행 절차가 어느 단계에서 부하를 일으키는지 눈으로 확인
- 문제점이 파악되면 쿼리를 변환 혹은 옵티마이저 힌트를 사용해 튜닝
- 그것만으로 부족하다면 인덱스 조정을 병행

### Explain Plan
- SQL 수행 이전 실행계획을 확인하고자 할 때, `explain plan` 명령을 사용함. 이 명령어를 사용하려면 먼저 `plan_table`을 생성해야함
- 오라클 10g 부터는 설치 시 기본적으로 `sys.plan_table$` 테이블이 만들어짐
- `plan_table`이 있다면, `explain plan for` 명령으를 통해 SQL에 대항 실행계획을 `plan_table`에 저장할 수 있음
- SQL Repository에 저장된 모든 SQL에 대해 매일 `explain plan` 명령을 수행해 실행계획을 별도 테이블로 저장해 둔다면 안정적인 시스템 운영 및 성능관리에 활용할 수 있음

### AutoTrace
- SQL 튜닝에 유용한 정보를 많이 포함하고 있어 즐겨 사용되는 도구 중 하나
- 아래 같은 옵션 조합이 있음:
	- `set autotrace on`: SQL을 실제 수행하고 그 결과와 함께 실행계획 및 실행통계를 출력
	- `set autotrace on explain`: SQL을 실제 수행하고 그 결과와 함계 실행계획을 출력
	- `set autotrace on statistics`: SQL을 실제 수행하고 그 결과와 함꼐 실행통계를 출력
	- `set autotrace traceonly`: SQL을 실제 수행하지만 그 결과는 출력하지 않고 실행계획과 통계만을 출력
	- `set autotrace traceonly explain`: SQL을 실제 수행하지 않고 실행계획만 출력
	- `set autotrace traceonly statistics`: SQL을 실제 수행하지만 그 결과는 출력하지 않고 실행통계만을 출력

### SQL 트레이스
- SQL을 튜닝할 때 가장 많이 사용되는 도구
- 사전 실행계획과 AutoTrace 결과만으로 부하원인을 찾을 수 없을 때, SQL 트레이스를 통해 쉽게 찾아낼 수 있음
- 트레이스 파일을 TKProf 유틸리티를 사용하면 트레이스 파일을 포맷팅할 수 있음
- ![[Pasted image 20251030072204.png]]
- SQL 문 바로 아래 Call 칼럼들의 의미:
	- `call`
		- [[커서]] 상태에 따라 Parse, Execute, Fetch 세 개의 Call로 나누어 각각에 대한 통계정보를 보여줌
			- `Parse`: 커서를 파싱하고 실행계획을 생성하는 데 대한 통계
			- `Execute`: 커서의 실행 단계에 대한 통계
			- `Fetch`: 레코드를 실제로 `Fetch`하는 데 대한 통계
	- `count`
		- `Parse`, `Execute`, `Fetch` 각 단계가 수행된 횟수
	- `cpu`
		- 현재 커서가 각 단계에서 사용한 `cpu time`
	- `elapsed`
		- 현재 커서가 각 단계를 수행하는 데 소요된 시간
	- `disk`
		- 디스크로부터 읽은 블록 수
	- `query`
		- Consistent 모드에서 읽은 버퍼 블록 수
	- `current`
		- Current 모드에서 읽은 버퍼 블록 수
	- `rows`
		- 각 단계에서 읽거나 갱신한 처리 건수