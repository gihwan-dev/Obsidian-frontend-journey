날씨가 많이 춥네요~~ 이번주는 오늘, 내일 날씨가 가장 춥더라고요! 자전거 타는데 손이 시려운거 보니 진짜 겨울이 왔구나~ 싶었습니다ㅎㅎ 옷 따뜻하게 입으시고 건강 잘 챙기십쇼!! 병가는 무급이라고 하더라고요!! 아프면 안됩니다~~

오늘 읽었던 내용은 트랜잭션 Lock과 동시성 제어에 관한 내용이었습니다. 트랜잭션 수준 읽기 일관성에 대한 내용을 읽으면서 Oracle이 다른 DBMS와 어떻게 다른지 잘 이해할 수 있었습다. 몰랐는데 TX 라는 단어가 트랜잭션을 뜻하는 약어라고 하더라고요...? 허허... 그렇게 많이 봐왔던 단어인데 왜 몰랐을까 하며 많이 반성했습니다!

지난 회고에 하나의 SQL 스크립트(?)가 곧 하나의 트랜잭션이지 않을까? 라고 적었었는데, 제 생각이 틀렸더라고요! 그래서 다시 한 번 정리하면 아래와 같습니다:

**하나의 SQL 문장 = 하나의 쿼리**

```sql
SELECT * FROM employees WHERE dept_id = 10;  -- 쿼리 1개

UPDATE employees SET salary = salary * 1.1;  -- 쿼리 1개

INSERT INTO log VALUES (1, 'test');          -- 쿼리 1개
```

세미콜론(`;`)으로 구분되는 각각의 SQL 문이 하나의 쿼리입니다. CRUD 작업을 수행하는 독립적인 명령문이라고 합니다ㅎㅎ

**논리적인 작업 단위 = 하나 이상의 쿼리 묶음**

아래처럼 명시적으로 정의할 수 있고:
```sql
-- SQL Server, PostgreSQL, MySQL 등
BEGIN TRANSACTION;  -- 또는 START TRANSACTION;
  UPDATE account SET balance = balance - 10000 WHERE id = 'A';
  UPDATE account SET balance = balance + 10000 WHERE id = 'B';
COMMIT;  -- 또는 ROLLBACK;
```

Oracle의 경우 아래처럼 암시적으로 처리될 수 있다고 합니다:
```sql
-- 트랜잭션이 자동으로 시작됨 (첫 DML 실행 시)
UPDATE account SET balance = balance - 10000 WHERE id = 'A';  -- 트랜잭션 시작!
UPDATE account SET balance = balance + 10000 WHERE id = 'B';  -- 같은 트랜잭션 내
INSERT INTO log VALUES (...);                                 -- 같은 트랜잭션 내

COMMIT;  -- 트랜잭션 종료 (성공)
-- 또는 ROLLBACK; -- 트랜잭션 종료 (취소)
```

**트랜잭션 시작 시점:**
- 첫 번째 `INSERT`, `UPDATE`, `DELETE`, `SELECT FOR UPDATE` 실행 시
- 이전 트랜잭션이 COMMIT/ROLLBACK으로 종료된 직후

**트랜잭션 종료 시점:**
- `COMMIT` 실행
- `ROLLBACK` 실행
- DDL 문 실행 (자동 COMMIT)
- 세션 종료

이라고 합니다~~! 그래서 읽기 일관성에 대해서 문장 수준 읽기 일관성, 트랜잭션 수준 읽기 일관성 두 경우로 나눌 수 있다고 합니다. 이런 읽기 일관성을 트랜잭션 고립화 수준을 통해 높이거나 낮출 수 있으며, 낮을 수록 일관성이 보장되지 않지만? 동시성이 올라간다고 합니다! 역시 모든건 트레이드오프구나... 하는 생각을 했습니다.

참고로 Oracle에서는 읽기 일관성을 보장하기 위해 Lock을 사용하는게 아닌 Undo를 활용하기 때문에 고립화 수준을 높이더라도 동시성이 저하되지 않는다고 합니다!

이외에 오라클 Lock에 대한 내용도 약간 학습했는데, 이것까지 적으면 너~~무 길어질거 같아서 생략하겠습니다!! [따로 정리한 내용](https://publish.obsidian.md/gihwan-dev/DB/%EC%98%A4%EB%9D%BC%ED%81%B4+%EC%84%B1%EB%8A%A5+%EA%B3%A0%EB%8F%84%EC%99%80+%EC%9B%90%EB%A6%AC%EC%99%80+%ED%95%B4%EB%B2%95+I/%EC%98%A4%EB%9D%BC%ED%81%B4+%EC%84%B1%EB%8A%A5+%EA%B3%A0%EB%8F%84%ED%99%94+%EC%9B%90%EB%A6%AC%EC%99%80+%ED%95%B4%EB%B2%95+-+10.27)을 참고하시면 좋을거 같습니다!!

즐거운 월요일 이네요~~ 아침마다 일어나는게 행복하다 라고 머리에 강제 주입하며 일어나고있는 요즘입니다ㅎㅎ 효과가 있는거 같기도 하네요~~! 다들 월요팅 입니다!!!