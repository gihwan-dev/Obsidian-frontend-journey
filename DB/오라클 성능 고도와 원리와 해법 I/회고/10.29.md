오늘 읽었던 내용은 이전 내용에 이어서 TX Lock 을 발생시키는 원인들에 대한 것이었습니다.

거의 뭐 검은건 글씨고 흰건 종이다 라는 느낌으로 읽어서 뭘 읽은걸까... 하는 느낌이긴 한데 그래도 "Lock을 푸는 열쇠, 커밋" 라는 내용에서 얻어간 내용이 있었던거 같아요.

책에서는 가끔 블로킹과 교착상태를 구분하지 못하는 분들을 만난다고 하며 **블로킹**과 **교착 상태(Dead Lock)** 의 차이점에 대해 말해줍니다.

**블로킹**
Lock 경합이 발생해 특정 세션이 작업을 진행하지 못하고 멈춰 선 경우를 말합니다. 이것을 해소하는 방법은 "커밋" 밖에 없다고 합니다.

**교착 상태(Dead Lock)**
두 세션이 각각 Lock을 설정한 리소스를, 서로 액세스 하려고 마주보고 진행하는 상황이며, 둘 중 하나가 뒤로 물러나지 않으면 영영 풀릴 수 없다고 합니다.

오라클에서 교착 상태가 발생하면, 이를 먼저 인지한 세션이 롤백을 진행한 후 `ORA-00060: deadlock detected while waiting for resource` 에러를 던진다고 합니다. 교착 상태를 발생시킨 문장 하나만 롤백한다고 하네요! 그렇게 되면 교착 상태가 해소되지만 **블로킹** 상태에 놓이게 된다고 합니다.

이 메시지를 받은 세션은 커밋 또는 롤백을 결정해야 합니다. 만약 프로그램 내에서 이 에러에 대한 예외 처리가 되어있지 않다면 대기 상태를 지속하게 된다고 하네요!

오라클에서는 "읽기" 작업에 Lock을 사용하지 않습니다. 그래서 Lock 경합이 상대적으로 적게 발생합니다. 그래서 트랜잭션을 다른 DBMS 대비 더 길게 가져갈 수 있습니다.

다만 트랜잭션이 너무 길면 롤백할 때 너무 많은 시간이 걸릴 수 있습니다. 그렇다고 너무 자주 커밋하면 `Snapshot too old(ORA-01555)` 에러를 유발할 가능성이 크고, LGWR가 로그 버퍼를 비우는 동안 발생하는 `log file sync` 대기 이벤트로 인해 성능 저하 현상을 겪을 수 있다고 합니다.

10gR2 부터는 비동기식 커밋을 활용해 성능을 개선할 수 있는데, 다만 안정성이 떨어진다고 합니다!!

벌써 수요일 이네요!! 날씨가 방심하다 감기걸리기 좋은 날씨인거 같아요!! 다들 감기 조심하시고 건강 잘 챙기십쇼!! 수요팅입니다~!~!
