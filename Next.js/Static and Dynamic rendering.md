Next.js 에서 라우트는 정적 또는 동적으로 렌더될 수 있다.

- 정적 라우트에서, 컴포넌트들은 서버에서 빌드타임에 렌더된다. 그결과는 캐쉬 되어 연속적인 요청에 재사용될 수 있다.
- 동적 라우트에서, 컴포넌트들은 서버에서 요청타임에 렌더된다.

---

## Static Rendering (Defalut)

정적렌더링은 모든 렌더링이 미리 완료되어 지리적으로 유저에게 가까운 CDN에서 제공될 수 있기 때문에 성능을 향상시켜줄 수 있다.

레이아웃 또는 페이지에서 동적 함수 또는 동적 데이터 페칭을 사용해서 다이나믹 렌더링으로 설정할 수 있다. 이렇게 하면 Next.js가 매 요청마다 라우트를 동적으로 렌더할 것이다.

다음 표는 동적 함수와 정적 데이터 패칭(캐싱)이 라우트의 렌더링 동작에 어떻게 영향을 미치는지에 대해 요약한 것이다.

![[Pasted image 20230914222056.png]]

어떤 상황에 라우트가 정적으로 렌더될 수 있는지 확인해라. 데이터 요청이 캐쉬되고 동적 함수가 없을 때 정적으로 렌더된다.

---

## Static Data Fetching (Default)

기본적으로 Next,js 는 캐싱 동작을 설정하지 않아도 `fetch()` 의 결과를 캐쉬한다. 이것은 `cache` 옵션을 따로 설정하지 않는다면 `force-chache` 옵션을 기본적으로 사용한다는 의미다.

만약 라우트의 fetch 요청이 `revalidate` 옵션을 사용한다면, 라우트는 revalidation 시간 동안 정적으로 re-render 할 것이다.

---

## Dynamic Rendering

정적 렌더링을 하는 동안 만약 동적 함수 또는 동적 `fetch()` 요청이 발견된다면, Next.js 는 요청 시점에 전체 경로를 동적으로 렌더링하도록 전환한다. 캐쉬된 데이터 요청은 동적 렌더링을 하는 동안 재사용 될 수 있다.

## Using Dynamic Functions

동적 함수는 요청 시점에만 알 수 있는 정보에 의존한다. 예를들면 유저의 쿠키, 현재 요청의 헤더, 또는 URL의 search params 등이 있다. Next.js 에서 이 동적 함수는 :

- 서버컴포넌트에서 `cookies()`, `headers()` 를 사용하면 전체 라우트를 요청 시점에 동적으로 렌더링 하도록 설정할 것이다.
- 클라이언트 컴포넌트에서 `useSearchParams()` 를 사용하면 정적 렌더링을 건너뛰고 클라이언트에서 가장 가까운 상위 Suspense 경계까지 모든 클라이언트 컴포넌트를 렌더링한다.
    - `useSearchParams()` 를 사용하는 클라이언트 컴포넌트를 `<Suspense />` 경계로 감싸는 것을 추천한다. 이는 위 상황의 클라이언트 컴포넌트들이 정적으로 렌더될 수 있도록 해준다.
- 페이지에서 `searchParams` prop 을 사용하는 것은 페이지가 요청 시점에 동적으로 렌더되도록 한다.

## Using Dynamic Data Fetches

동적 데이터 fetche는 `cache` 옵션을 `no-store` 또는 `revalidate` 를 0으로 설정해 캐쉬를 하지 않도록 설정하는 것을 의미한다.

한 레이아웃 또는 페이지에서의 모든 `fetch` 요청에 관한 설정은 segment config 객체를 통해 설정할 수 있다.